{% extends 'base.html' %}

{% block title %}–õ—ñ–∫–∞—Ä—ñ - VetBooking{% endblock %}

{% block content %}
<div class="page-header">
    <div class="container">
        <h1>–ù–∞—à—ñ –≤–µ—Ç–µ—Ä–∏–Ω–∞—Ä–∏</h1>
    </div>
</div>

<div class="container">
    <div class="filters-section">
        <div class="filter-group">
            <label>–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è:</label>
            <select id="specialization-filter">
                <option value="">–í—Å—ñ —Å–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó</option>
            </select>
        </div>
        <button onclick="applyFilters()" class="btn-primary">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
    </div>

    <div id="doctors-grid" class="cards-grid">
        <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>
</div>

<script>
    async function loadDoctors() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const specialization = urlParams.get('specialization') || '';

            let url = '/api/doctors/?ordering=-rating';
            if (specialization) url += `&specialization=${specialization}`;

            const response = await fetchAPI(url);
            const data = await response.json();
            const doctors = data.results || data;

            const grid = document.getElementById('doctors-grid');
            grid.innerHTML = doctors.map(doctor => `
                <div class="card doctor-card">
                    <img src="${doctor.photo || '/static/images/doctor-placeholder.jpg'}"
                         alt="${doctor.full_name}">
                    <div class="card-content">
                        <h3>${doctor.full_name}</h3>
                        <p class="specialization">${doctor.specialization_display}</p>
                        <p class="clinic">üè• ${doctor.clinic_name}</p>
                        <p class="experience">–î–æ—Å–≤—ñ–¥: ${doctor.experience_years} —Ä–æ–∫—ñ–≤</p>
                        <div class="rating">‚≠ê ${doctor.rating}/5</div>
                        <a href="/doctors/${doctor.id}/" class="btn-primary">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error:', error);
        }
    }

    function applyFilters() {
        const specialization = document.getElementById('specialization-filter').value;
        const params = new URLSearchParams();
        if (specialization) params.set('specialization', specialization);
        window.location.href = `/doctors/?${params.toString()}`;
    }

    loadDoctors();
</script>
{% endblock %}