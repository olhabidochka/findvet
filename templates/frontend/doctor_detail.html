{% extends 'base.html' %}

{% block title %}–õ—ñ–∫–∞—Ä - VetBooking{% endblock %}

{% block content %}
<div class="container">
    <div id="doctor-detail">
        <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>
</div>

<script>
    const doctorId = {{ doctor_id }};

    async function loadDoctor() {
        try {
            const response = await fetchAPI(`/api/doctors/${doctorId}/`);
            const doctor = await response.json();

            document.getElementById('doctor-detail').innerHTML = `
                <div class="detail-header">
                    <img src="${doctor.photo || '/static/images/doctor-placeholder.jpg'}"
                         alt="${doctor.full_name}">
                    <div class="detail-header-info">
                        <h1>${doctor.full_name}</h1>
                        <p class="specialization">${doctor.specialization_display}</p>
                        <div class="rating">‚≠ê ${doctor.rating}/5</div>
                        <p>üè• ${doctor.clinic.name}</p>
                        <p>üìû ${doctor.phone}</p>
                        <p>‚úâÔ∏è ${doctor.email}</p>
                        <button onclick="addToFavorites()" class="btn-secondary" id="favorite-btn">
                            ‚ù§Ô∏è –î–æ–¥–∞—Ç–∏ –≤ –æ–±—Ä–∞–Ω—ñ
                        </button>
                        <a href="/appointments/create/?doctor=${doctorId}" class="btn-primary">
                            –ó–∞–ø–∏—Å–∞—Ç–∏—Å—è –Ω–∞ –ø—Ä–∏–π–æ–º
                        </a>
                    </div>
                </div>

                <div class="detail-content">
                    <section class="section">
                        <h2>–ü—Ä–æ –ª—ñ–∫–∞—Ä—è</h2>
                        <p><strong>–î–æ—Å–≤—ñ–¥:</strong> ${doctor.experience_years} —Ä–æ–∫—ñ–≤</p>
                        <p>${doctor.bio}</p>
                    </section>

                    <section class="section">
                        <h2>–û—Å–≤—ñ—Ç–∞</h2>
                        <p>${doctor.education}</p>
                    </section>

                    <section class="section">
                        <h2>–†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏</h2>
                        <div class="schedule">
                            ${doctor.schedules.map(s => `
                                <div class="schedule-item">
                                    <strong>${s.weekday_display}:</strong>
                                    ${s.start_time} - ${s.end_time}
                                </div>
                            `).join('')}
                        </div>
                    </section>
                </div>
            `;
        } catch (error) {
            console.error('Error:', error);
        }
    }

    async function addToFavorites() {
        try {
            await fetchAPI(`/api/doctors/${doctorId}/add_to_favorites/`, {
                method: 'POST'
            });
            alert('–î–æ–¥–∞–Ω–æ –≤ –æ–±—Ä–∞–Ω—ñ!');
            document.getElementById('favorite-btn').disabled = true;
        } catch (error) {
            alert('–ü–æ–º–∏–ª–∫–∞. –ú–æ–∂–ª–∏–≤–æ, –≤–∏ –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ñ.');
        }
    }

    loadDoctor();
</script>
{% endblock %}