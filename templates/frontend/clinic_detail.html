{% extends 'base.html' %}

{% block title %}–ö–ª—ñ–Ω—ñ–∫–∞ - VetBooking{% endblock %}

{% block content %}
<div class="container">
    <div id="clinic-detail" class="detail-page">
        <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
    </div>
</div>

<script>
    const clinicId = {{ clinic_id }};

    async function loadClinic() {
        try {
            const response = await fetchAPI(`/api/clinics/${clinicId}/`);
            const clinic = await response.json();

            document.getElementById('clinic-detail').innerHTML = `
                <div class="detail-header">
                    <img src="${clinic.image || '/static/images/clinic-placeholder.jpg'}"
                         alt="${clinic.name}">
                    <div class="detail-header-info">
                        <h1>${clinic.name}</h1>
                        <div class="rating">‚≠ê ${clinic.rating}/5</div>
                        <p class="address">üìç ${clinic.address}, ${clinic.city}</p>
                        <p class="phone">üìû ${clinic.phone}</p>
                        <p class="email">‚úâÔ∏è ${clinic.email}</p>
                        ${clinic.website ? `<p class="website">üåê <a href="${clinic.website}" target="_blank">${clinic.website}</a></p>` : ''}
                    </div>
                </div>

                <div class="detail-content">
                    <section class="section">
                        <h2>–ü—Ä–æ –∫–ª—ñ–Ω—ñ–∫—É</h2>
                        <p>${clinic.description}</p>
                    </section>

                    <section class="section">
                        <h2>–ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏</h2>
                        <p><strong>–î–Ω—ñ:</strong> ${clinic.working_days}</p>
                        <p><strong>–ß–∞—Å:</strong> ${clinic.working_hours_start} - ${clinic.working_hours_end}</p>
                    </section>

                    <section class="section">
                        <h2>–°–ø–µ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó</h2>
                        <div class="specializations">
                            ${clinic.specializations.map(s =>
                                `<span class="badge badge-lg">${s.specialization_display}</span>`
                            ).join('')}
                        </div>
                    </section>

                    <section class="section">
                        <h2>–ú—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è</h2>
                        <div id="map" style="width: 100%; height: 400px; background: #e0e0e0; border-radius: 8px;">
                            <p style="padding: 20px; text-align: center;">
                                –ö–∞—Ä—Ç–∞ Google Maps<br>
                                –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏: ${clinic.latitude}, ${clinic.longitude}
                            </p>
                        </div>
                    </section>

                    <section class="section">
                        <h2>–ù–∞—à—ñ –ª—ñ–∫–∞—Ä—ñ</h2>
                        <div id="doctors-list" class="cards-grid">
                            <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ª—ñ–∫–∞—Ä—ñ–≤...</div>
                        </div>
                    </section>

                    <section class="section">
                        <h2>–ü–æ—Å–ª—É–≥–∏</h2>
                        <div id="services-list" class="cards-grid">
                            <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Å–ª—É–≥...</div>
                        </div>
                    </section>

                    <section class="section">
                        <h2>–í—ñ–¥–≥—É–∫–∏</h2>
                        <div id="reviews-list"></div>
                    </section>
                </div>
            `;

            loadDoctors();
            loadServices();
            loadReviews();
            initMap(clinic.latitude, clinic.longitude);
        } catch (error) {
            console.error('Error loading clinic:', error);
            document.getElementById('clinic-detail').innerHTML =
                '<p class="error">–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –∫–ª—ñ–Ω—ñ–∫–∏</p>';
        }
    }

    async function loadDoctors() {
        try {
            const response = await fetchAPI(`/api/doctors/?clinic=${clinicId}`);
            const data = await response.json();
            const doctors = data.results || data;

            const list = document.getElementById('doctors-list');
            if (doctors.length === 0) {
                list.innerHTML = '<p class="no-results">–õ—ñ–∫–∞—Ä—ñ–≤ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }

            list.innerHTML = doctors.map(doctor => `
                <div class="card doctor-card">
                    <img src="${doctor.photo || '/static/images/doctor-placeholder.jpg'}"
                         alt="${doctor.full_name}">
                    <div class="card-content">
                        <h3>${doctor.full_name}</h3>
                        <p class="specialization">${doctor.specialization_display}</p>
                        <p class="experience">–î–æ—Å–≤—ñ–¥: ${doctor.experience_years} —Ä–æ–∫—ñ–≤</p>
                        <div class="rating">‚≠ê ${doctor.rating}/5</div>
                        <a href="/doctors/${doctor.id}/" class="btn-primary">–î–µ—Ç–∞–ª—å–Ω—ñ—à–µ</a>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error loading doctors:', error);
        }
    }

    async function loadServices() {
        try {
            const response = await fetchAPI(`/api/services/?clinic=${clinicId}`);
            const data = await response.json();
            const services = data.results || data;

            const list = document.getElementById('services-list');
            if (services.length === 0) {
                list.innerHTML = '<p class="no-results">–ü–æ—Å–ª—É–≥ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ</p>';
                return;
            }

            list.innerHTML = services.map(service => `
                <div class="card service-card">
                    <h3>${service.name}</h3>
                    <p class="service-type">${service.service_type_display}</p>
                    <p class="description">${service.description}</p>
                    <div class="service-footer">
                        <span class="price">${service.price} –≥—Ä–Ω</span>
                        <span class="duration">${service.duration_minutes} —Ö–≤</span>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error loading services:', error);
        }
    }

    async function loadReviews() {
        try {
            const response = await fetchAPI(`/api/clinic-reviews/?clinic=${clinicId}`);
            const data = await response.json();
            const reviews = data.results || data;

            const list = document.getElementById('reviews-list');
            if (reviews.length === 0) {
                list.innerHTML = '<p class="no-results">–í—ñ–¥–≥—É–∫—ñ–≤ –ø–æ–∫–∏ –Ω–µ–º–∞—î</p>';
                return;
            }

            list.innerHTML = reviews.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <strong>${review.user_name}</strong>
                        <span class="rating">‚≠ê ${review.rating}/5</span>
                    </div>
                    <p>${review.comment}</p>
                    <small>${new Date(review.created_at).toLocaleDateString('uk-UA')}</small>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error loading reviews:', error);
        }
    }

    function initMap(lat, lng) {
        // Note: This requires Google Maps API key
        // For now, just showing coordinates
        console.log(`Map initialized at ${lat}, ${lng}`);
    }

    loadClinic();
</script>
{% endblock %}